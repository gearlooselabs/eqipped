<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<% include ('function'); %>
    <%const string=JSON.stringify(product._id); %>

    <main class="my-8">
        <div class="container mx-3 px-6">
            <div class="md:flex ">
                <div class="w-full h-64 md:w-2/5 lg:h-2/4  rounded-lg">
                    <img class="h-4/5 sm:w-4/5 object-contain rounded-xl max-w-lg mx-auto " src="/img/<%= product.product.image %>" alt="<%= product.productCayegory %>">
                </div>
                <div class="w-full max-w-md mx-auto mt-5 md:ml-8 md:mt-0 md:w-2/5">
                    <h3 style="font-family: ubuntu;" class="text-black-700 font-semibold uppercase text-2xl "><%= product.product.name %> - <%= product.name %></h3>
                    <span style="font-family: ubuntu;" class="text-black-500 font-bold text-2xl">₹ <%= product.price %></span>
                    <hr class="my-3">
                    <div class="mt-2">
                        <div class="mt-3 text-black-800 text-lg">Product Description</div>
                         <div class="mt-1 mb-4 text-red-500 text-sm"><%= product.product.description %> </div>
                         <div>by: <span class="size py-1 mx-2 px-2 rounded uppercase text-xs"><%= product.product.brand %></span></div>
                         <div class="mt-3">
                            <label class="text-gray-700 text-sm" for="count">Variants</label>
                            <div class="flex items-center mt-1">
                                <% variants.forEach((variant) => { %>
                                   <% if(JSON.stringify(product._id) == JSON.stringify(variant._id)){ %>
                                    <a href = "/productDetails/<%= variant._id %>/<%= variant.product._id %>/1"><button class="variantHover currentVariant border p-2 m-2 rounded "><%= variant.name %></button></a>
                                   <% }else{ %>
                                    <a href = "/productDetails/<%= variant._id %>/<%= variant.product._id %>/1"><button class="variantHover border p-2 m-2 rounded "><%= variant.name %></button></a>
                                   <% } %>
                                <% }) %>
                            </div>
                        </div>
                         
                        <div class="mt-3 text-gray-700 text-sm" for="">Piece per pack: <%= product.piecePerPack %></div>
                    </div>
                
                    <div  class="flex items-center mt-6 justify-center">
                                    <label class="text-gray-700 text-sm hidden" for="product-qty">Qty:</label>
                                    <input type="number" class="w-14 p-1 pl-2 mx-2 border rounded hidden" id = "product-qty" placeholder="1" value = "1">
                                   <div id="buttonSection" >
                                       <% if(user.cart.length <= 0){%>
                                        <button id="add-cart-btn" class=" flex-col mr-4 add-to-cart py-2 px-4 bg-white-600 text-white text-md font-medium rounded hover:bg-white-500 focus:outline-none focus:bg-white-500">
                                            <span><svg class="h-4 w-4 float-left mt-1" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" stroke="currentColor"><path d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                                            </span>
                                            <span class="ml-3">Add to Cart</span>
                                    </button>
                                    <%} else if(checkCart(user.cart, string)){%>
                                        
                                        <button id="add-cart-btn" onclick="location.href='/cart'" class=" flex-col mr-4 add-to-cart py-2 px-4 bg-white-600 text-white text-md font-medium rounded hover:bg-white-500 focus:outline-none focus:bg-white-500">
                                            <span><svg class="h-4 w-4 float-left mt-1" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" stroke="currentColor"><path d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                                            </span>
                                            <span class="ml-3">Go To Cart</span>
                                        </button>
                        <%}else {%>
                            <button id="add-cart-btn" class=" flex-col mr-4 add-to-cart py-2 px-4 bg-white-600 text-white text-md font-medium rounded hover:bg-white-500 focus:outline-none focus:bg-white-500">
                                <span><svg class="h-4 w-4 float-left mt-1" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" stroke="currentColor"><path d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                                </span>
                                <span class="ml-3">Add to Cart</span>
                        </button>

                          <%}%>
                        </div>
                          
                          <button id="buy-now-btn"  class="ml-4 flex-col buy-now py-2 px-4 bg-white-600 text-white text-md font-medium rounded hover:bg-white-500 focus:outline-none focus:bg-white-500">
                            <span></span>
                              <span class="mx-6">Buy Now</span>
                          </button>


                    </div>
                </div>
                <div class="w-full max-w-md mx-auto mt-5 md:ml-8 md:mt-0 md:w-1/5">
                    <h3 style="font-family: ubuntu;" class="text-black-700 font-bold uppercase text-lg mb-4">Also Sold By</h3>
                    <% alsoSoldBy.forEach((item) => { %>
                       <a href = "/productDetails/<%= item._id %>/<%= item.product._id %>/1" class="group" >
                        <div class=" w-full flex border p-2 m-2 rounded">
                            <div class="w-1/3 h-full  md:h-2/2 ">
                                <img class="h-full w-full rounded-md object-contain max-w-lg mx-auto" src="/img/<%= item.product.image %>" alt="<%= product.productCayegory %>">
                            </div>
                            <div class="w-2/3 h-full  md:h-2/2 px-2">
                                <!-- <h3 class="text-black-800 text-sm "><%= item.vendor.fname %></h3> -->
                                <h3 class="text-black-800 text-sm group-hover:text-blue-500"><%= item.product.name %> - <%= item.name %></h3>
                                <div class="text-gray-400 text-xs my-1">by: <span class=" py-1 px- rounded uppercase text-xs"><%= item.brand %></span></div>
                                <span  class="text-black-800 text-sm">₹ <%= item.price %></span>
                            </div>
    
                        </div>
                       </a>
                    <% }) %>
                  
                    <a href="/similarproducts" class="text-sm float-right hover:underline SeeMore" >See more</a>
                </div>
            </div>



            function alertToLogIn() {

                swal({
                    title: "Register/Login",
                    text: "Authorize user have permission to place order.",
                    buttons: {
                        Register: {
                            text: "Register",
                            value: "/register",
                            className: "swal-icon5",
                        },
                        Login: {
                            text: "Login",
                            value: "/login",
                            className: "swal-icon5",
                            html: true
                        },
                        Login1: {
                            text: "Hidden Button",
                            className: "swal-icon1",
                        },
                    },
                    icon: "info",
                }).then(function (value) {
                    if (value == "login") {
                        window.location = value;
                    } else {
                        window.location = value;
                    }
                });
            }


            $('#add-cart-btn').click(function () {
                var params = {
                    pid: '<%= product._id %>',
                    qty: $('#product-qty').val(),
                    total: '<%= product.price %>'
                }

                $.ajax({
                    type: 'POST',
                    url: '/update-cart',
                    data: params,
                    dataType: 'json',
                    encode: true
                }).done(function (result) {
                    if (result.status == "success") {

                        $('#cartcount').html('<super><span id = "cartcount"><i class = "fa fa-circle" style= "font-size: 10px;color: orange"></i></span></super>');
                        alert('Product added to cart');
                        $("#buttonSection").load(window.location.href + " #buttonSection");
                    }
                })
            })
            $('#buy-now-btn').click(function () {
                var params = {
                    pid: '<%= product._id %>',
                    qty: $('#product-qty').val(),
                    total: '<%= product.price %>'
                }

                $.ajax({
                    type: 'POST',
                    url: '/update-cart',
                    data: params,
                    dataType: 'json',
                    encode: true,
                }).done(function (result) {
                    if (result.status == "success") {
                        $('#cartcount').html('<super><span id = "cartcount"><i class = "fa fa-circle" style= "font-size: 10px;color: orange"></i></span></super>');

                    }
                })
                var url = '/customer/checkout';
                document.write("");
                setTimeout(function () { window.location = url; }, 500);

            })


        </script>